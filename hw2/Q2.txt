########################################################
Tests on different orderings
#########################################################

Naive n-k-m:
Dimension       Time    Gflop/s       GB/s        Error
	  1024   0.215250   9.976690  40.023674 0.000000e+00
      1072   0.263791   9.340172  37.465242 0.000000e+00
      1120   0.326425   8.607963  34.524080 0.000000e+00
      1168   0.390712   8.156457  32.709629 0.000000e+00
      1216   0.464154   7.747632  31.066983 0.000000e+00
      1264   0.565197   7.146138  28.652395 0.000000e+00
      1312   0.640209   7.055203  28.285341 0.000000e+00
      1360   0.733908   6.854964  27.480339 0.000000e+00
      1408   0.836780   6.671547  26.743047 0.000000e+00
      1456   0.947573   6.514806  26.112919 0.000000e+00
      1504   1.058660   6.427129  25.759797 0.000000e+00
      1552   1.177674   6.348631  25.443612 0.000000e+00
      1600   1.301753   6.293050  25.219399 0.000000e+00
      1648   1.439357   6.219181  24.922009 0.000000e+00
      1696   1.587697   6.145257  24.624508 0.000000e+00
      1744   1.725760   6.147366  24.631762 0.000000e+00
      1792   1.885667   6.103501  24.454875 0.000000e+00
      1840   2.086131   5.972304  23.928167 0.000000e+00
      1888   2.255726   5.966912  23.905574 0.000000e+00
      1936   2.452830   5.916688  23.703426 0.000000e+00
      1984   2.644453   5.906350  23.661124 0.000000e+00

k-n-m:
Dimension       Time    Gflop/s       GB/s        Error
      1024   0.248718   8.634201  34.637988 0.000000e+00
      1072   0.278335   8.852100  35.507492 0.000000e+00
      1120   0.372985   7.533423  30.214407 0.000000e+00
      1168   0.439049   7.258472  29.108463 0.000000e+00
      1216   0.520738   6.905759  27.691185 0.000000e+00
      1264   0.692100   5.835825  23.398705 0.000000e+00
      1312   0.899114   5.023618  20.140418 0.000000e+00
      1360   0.942580   5.337386  21.396638 0.000000e+00
      1408   1.096359   5.091960  20.411238 0.000000e+00
      1456   1.321667   4.670808  18.721728 0.000000e+00
      1504   1.426748   4.768987  19.113997 0.000000e+00
      1552   1.623906   4.604095  18.451977 0.000000e+00
      1600   1.767913   4.633713  18.569604 0.000000e+00
      1648   2.013132   4.446613  17.818829 0.000000e+00
      1696   2.252834   4.330902  17.354253 0.000000e+00
      1744   2.482686   4.273145  17.121984 0.000000e+00
      1792   2.746082   4.191125  16.792564 0.000000e+00
      1840   2.912640   4.277565  17.138159 0.000000e+00
      1888   3.193139   4.215199  16.887588 0.000000e+00
      1936   3.586344   4.046636  16.211627 0.000000e+00
      1984   3.874928   4.030801  16.147583 0.000000e+00

m-k-n
Dimension       Time    Gflop/s       GB/s        Error
        16   0.488595   4.093378  19.443545 0.000000e+00
        64   0.641971   3.115654  13.046802 0.000000e+00
       112   0.502748   3.979368  16.343831 0.000000e+00
       160   1.313861   1.527589   6.224927 0.000000e+00
       208   0.979675   2.057577   8.349016 0.000000e+00
       256   4.051602   0.496906   2.010917 0.000000e+00
       304   1.270465   1.592174   6.431546 0.000000e+00
       352   1.406828   1.426083   5.752948 0.000000e+00
       400   1.292497   1.584530   6.385656 0.000000e+00
       448   2.188712   0.985954   3.970226 0.000000e+00
       496   1.406003   1.562181   6.286519 0.000000e+00
       544   1.844899   1.221665   4.913607 0.000000e+00
       592   1.362730   1.522493   6.120831 0.000000e+00
       640   3.542494   0.591999   2.379095 0.000000e+00
       688   4.761474   0.547159   2.198181 0.000000e+00
       736   2.421701   0.987789   3.967261 0.000000e+00
       784   5.689017   0.508232   2.040708 0.000000e+00
       832   5.628641   0.409286   1.643045 0.000000e+00
       880   7.436031   0.366578   1.471312 0.000000e+00
       928  10.227848   0.312550   1.254242 0.000000e+00
       976  12.581734   0.295576   1.185938 0.000000e+00
      1024   7.279018   0.295024   1.183553 0.000000e+00
      1072   8.984115   0.274245   1.100051 0.000000e+00
      1120   9.952409   0.282329   1.132342 0.000000e+00
      1168  11.907731   0.267627   1.073257 0.000000e+00
      1216  13.868415   0.259301   1.039762 0.000000e+00

Blocked 16 n-k-m:
Dimension       Time    Gflop/s       GB/s        Error
        16   0.118356  16.898201  16.898201 0.000000e+00
        64   0.118369  16.897671  10.561044 0.000000e+00
       112   0.118246  16.919059   9.668034 0.000000e+00
       160   0.126445  15.872810   8.730046 0.000000e+00
       208   0.121381  16.606908   8.942181 0.000000e+00
       256   0.159543  12.618922   6.703802 0.000000e+00
       304   0.124288  16.275162   8.565875 0.000000e+00
       352   0.126051  15.916160   8.319811 0.000000e+00
       400   0.125818  16.277442   8.464270 0.000000e+00
       448   0.138213  15.613355   8.085487 0.000000e+00
       496   0.134897  16.282329   8.403783 0.000000e+00
       544   0.141517  15.926337   8.197379 0.000000e+00
       592   0.126271  16.430934   8.437507 0.000000e+00
       640   0.141671  14.802931   7.586502 0.000000e+00
       688   0.161059  16.175961   8.276073 0.000000e+00
       736   0.151746  15.763992   8.053344 0.000000e+00
       784   0.179746  16.085683   8.206981 0.000000e+00
       832   0.153301  15.027483   7.658236 0.000000e+00
       880   0.171178  15.924335   8.106934 0.000000e+00
       928   0.201278  15.882114   8.077972 0.000000e+00
       976   0.228371  16.284279   8.275617 0.000000e+00
      1024   0.217144   9.889693   5.022110 0.000000e+00
      1072   0.151572  16.255283   8.248949 0.000000e+00
      1120   0.177050  15.870374   8.048547 0.000000e+00
      1168   0.202053  15.772255   7.994157 0.000000e+00
      1216   0.235926  15.242483   7.721521 0.000000e+00
      1264   0.255358  15.816940   8.008577 0.000000e+00
      1312   0.291694  15.484737   7.836788 0.000000e+00
      1360   0.330380  15.227667   7.703408 0.000000e+00
      1408   0.399827  13.962571   7.060619 0.000000e+00
      1456   0.402035  15.355032   7.761884 0.000000e+00
      1504   0.457192  14.882455   7.520389 0.000000e+00
      1552   0.510775  14.637791   7.394348 0.000000e+00
      1600   0.567464  14.436150   7.290256 0.000000e+00
      1648   0.633494  14.130541   7.133865 0.000000e+00
      1696   0.667095  14.625798   7.381889 0.000000e+00
      1744   0.700132  15.152677   7.645846 0.000000e+00
      1792   0.946826  12.155527   6.132029 0.000000e+00
      1840   0.838748  14.854292   7.491730 0.000000e+00
      1888   0.924781  14.554494   7.338919 0.000000e+00
      1936   0.967216  15.004541   7.564273 0.000000e+00
      1984   1.101646  14.177929   7.146133 0.000000e+00

BLocked 16 m-k-n:
Dimension       Time    Gflop/s       GB/s        Error
        16   0.492654   4.059650   4.059650 0.000000e+00
        64   0.585812   3.414335   2.133959 0.000000e+00
       112   0.493098   4.057242   2.318424 0.000000e+00
       160   0.493783   4.064622   2.235542 0.000000e+00
       208   0.499155   4.038336   2.174489 0.000000e+00
       256   1.213845   1.658586   0.881124 0.000000e+00
       304   0.500876   4.038526   2.125540 0.000000e+00
       352   0.519509   3.861824   2.018681 0.000000e+00
       400   0.510802   4.009378   2.084877 0.000000e+00
       448   0.659378   3.272734   1.694809 0.000000e+00
       496   0.542676   4.047408   2.088985 0.000000e+00
       544   0.571973   3.940480   2.028188 0.000000e+00
       592   0.522692   3.969352   2.038316 0.000000e+00
       640   0.781630   2.683050   1.375063 0.000000e+00
       688   0.676024   3.853834   1.971729 0.000000e+00
       736   0.632177   3.783957   1.933108 0.000000e+00
       784   0.772034   3.745097   1.910764 0.000000e+00
       832   0.723889   3.182425   1.621813 0.000000e+00
       880   0.740128   3.682996   1.874980 0.000000e+00
       928   0.879523   3.634601   1.848633 0.000000e+00
	   976   1.000767   3.716008   1.888463 0.000000e+00
      1024   3.705088   0.579604   0.294330 0.000000e+00
      1072   0.683131   3.606703   1.830267 0.000000e+00
      1120   0.776239   3.619832   1.835772 0.000000e+00
      1168   0.935184   3.407700   1.727191 0.000000e+00
      1216   1.162536   3.093316   1.567009 0.000000e+00
      1264   1.102495   3.663487   1.854930 0.000000e+00
      1312   1.278168   3.533812   1.788454 0.000000e+00
      1360   1.513981   3.322970   1.681032 0.000000e+00
      1408   2.240677   2.491488   1.259900 0.000000e+00
      1456   1.711503   3.606919   1.823278 0.000000e+00
      1504   1.965280   3.462176   1.749504 0.000000e+00
      1552   2.102985   3.555240   1.795946 0.000000e+00
      1600   2.792576   2.933492   1.481414 0.000000e+00
      1648   2.774713   3.226143   1.628732 0.000000e+00
      1696   2.839621   3.435953   1.734184 0.000000e+00
      1744   3.012099   3.522088   1.777200 0.000000e+00
      1792   7.225327   1.592893   0.803557 0.000000e+00
      1840   3.500996   3.558704   1.794825 0.000000e+00
      1888   3.733105   3.605502   1.818029 0.000000e+00
      1936   4.068158   3.567371   1.798427 0.000000e+00
      1984   5.066681   3.082701   1.553781 0.000000e+00

As we can see from above, the order of loops can affect the performance greatly. The naive algorithm is used for comparisons mainly. Because the data is stored in column-major. Keeping the column dimension unchanged longer gives better performance, because of higher hit rate in cache. n is the column dimension for C and B, and for A it's k. That is why we see n-k-m performs the best and m-k-n performs very bad. Overall, the idea is to keep and use data in cache as much as possible. The same conclusion applies to the blocked algorithm but the effect is smaller if the blocks are small, because whole blocks can be stored in cache and it is less likely to have cache miss even with bad orderings.


#########################################################
More timings with different block sizes. (ordering: n-k-m)
#########################################################

BLOCK_SIZE=8
Dimension       Time    Gflop/s       GB/s        Error
         8   0.155522  12.859900  25.719800 0.000000e+00
        56   0.163576  12.228381  13.975292 0.000000e+00
       104   0.162797  12.285262  13.230283 0.000000e+00
       152   0.168270  11.895940  12.522042 0.000000e+00
       200   0.169143  11.918904  12.395660 0.000000e+00
       248   0.169035  11.911105  12.295334 0.000000e+00
       296   0.173587  11.653395  11.968352 0.000000e+00
       344   0.177463  11.469314  11.736042 0.000000e+00
       392   0.179298  11.422514  11.655627 0.000000e+00
       440   0.185053  11.047708  11.248575 0.000000e+00
       488   0.184462  11.340313  11.526219 0.000000e+00
       536   0.175548  12.280803  12.464099 0.000000e+00
       584   0.197258  12.116749  12.282732 0.000000e+00
       632   0.175033  11.537764  11.683812 0.000000e+00
       680   0.216409  11.623600  11.760348 0.000000e+00
       728   0.197029  11.749390  11.878504 0.000000e+00
       776   0.238882  11.736911  11.857910 0.000000e+00
       824   0.191533  11.684191  11.797629 0.000000e+00
       872   0.228918  11.585870  11.692162 0.000000e+00
       920   0.267260  11.654382  11.755724 0.000000e+00
       968   0.312263  11.618928  11.714952 0.000000e+00
      1016   0.182464  11.495645  11.586162 0.000000e+00
      1064   0.209135  11.519342  11.605953 0.000000e+00
      1112   0.243166  11.309460  11.390823 0.000000e+00
      1160   0.271924  11.480403  11.559578 0.000000e+00
      1208   0.309947  11.374777  11.450106 0.000000e+00
      1256   0.346677  11.430726  11.503533 0.000000e+00
      1304   0.389952  11.372382  11.442151 0.000000e+00
      1352   0.449137  11.004777  11.069894 0.000000e+00
      1400   0.494051  11.108158  11.171633 0.000000e+00
      1448   0.546389  11.113054  11.174452 0.000000e+00
      1496   0.606336  11.043611  11.102668 0.000000e+00
      1544   0.674129  10.920165  10.976746 0.000000e+00
      1592   0.738441  10.928068  10.982983 0.000000e+00
      1640   0.816753  10.801175  10.853863 0.000000e+00
      1688   0.885591  10.862105  10.913584 0.000000e+00
      1736   0.962778  10.868080  10.918163 0.000000e+00
      1784   1.053511  10.778924  10.827260 0.000000e+00
      1832   1.139550  10.791277  10.838400 0.000000e+00
      1880   1.240035  10.716908  10.762512 0.000000e+00
      1928   1.335511  10.732567  10.777100 0.000000e+00
      1976   1.461065  10.561394  10.604152 0.000000e+00

BLCOK_SIZE=32
Dimension       Time    Gflop/s       GB/s        Error
        32   0.096067  20.819179  10.409590 0.000000e+00
        64   0.097755  20.460920   7.672845 0.000000e+00
        96   0.098544  20.308377   6.769459 0.000000e+00
       128   0.099019  20.205121   6.314100 0.000000e+00
       160   0.100609  19.948957   5.984687 0.000000e+00
       192   0.100468  20.007651   5.835565 0.000000e+00
       224   0.099963  20.013528   5.718151 0.000000e+00
       256   0.134267  14.994522   4.217209 0.000000e+00
       288   0.100283  20.009238   5.558122 0.000000e+00
       320   0.102950  19.734063   5.426867 0.000000e+00
       352   0.099193  20.225657   5.516088 0.000000e+00
       384   0.131004  15.560058   4.214182 0.000000e+00
       416   0.100812  19.995258   5.383339 0.000000e+00
       448   0.111385  19.374002   5.189465 0.000000e+00
       480   0.109712  20.160378   5.376101 0.000000e+00
       512   0.168211  12.766616   3.391132 0.000000e+00
       544   0.114186  19.738421   5.224876 0.000000e+00
       576   0.117401  19.533439   5.154658 0.000000e+00
       608   0.115104  19.526309   5.138502 0.000000e+00
       640   0.127004  16.512423   4.334511 0.000000e+00
       672   0.122692  19.787001   5.182310 0.000000e+00
       704   0.115153  18.179948   4.751577 0.000000e+00
       736   0.121644  19.665071   5.130019 0.000000e+00
       768   0.183959  14.774576   3.847546 0.000000e+00
       800   0.107767  19.003980   4.941035 0.000000e+00
       832   0.121266  18.997221   4.931971 0.000000e+00
       864   0.133462  19.330463   5.011601 0.000000e+00
       896   0.163989  17.545667   4.543074 0.000000e+00
       928   0.167177  19.121787   4.945290 0.000000e+00
       960   0.190696  18.558071   4.794168 0.000000e+00
       992   0.203414  19.196123   4.953838 0.000000e+00
      1024   0.191109  11.236985   2.897035 0.000000e+00
      1056   0.128442  18.336377   4.723006 0.000000e+00
      1088   0.147768  17.431548   4.486060 0.000000e+00
      1120   0.152496  18.425808   4.738065 0.000000e+00
      1152   0.181365  16.859128   4.331859 0.000000e+00
      1184   0.188091  17.648854   4.531462 0.000000e+00
      1216   0.206689  17.398522   4.464094 0.000000e+00
      1248   0.213432  18.214373   4.670352 0.000000e+00
      1280   0.292986  14.315703   3.668399 0.000000e+00
      1312   0.244416  18.479970   4.732675 0.000000e+00
      1344   0.275469  17.626071   4.511435 0.000000e+00
      1376   0.314854  16.549173   4.233509 0.000000e+00
      1408   0.320374  17.425297   4.455332 0.000000e+00
      1440   0.335646  17.792460   4.546962 0.000000e+00
      1472   0.363304  17.558314   4.485004 0.000000e+00
      1504   0.382386  17.793903   4.543124 0.000000e+00
      1536   0.573930  12.628287   3.222844 0.000000e+00
      1568   0.425529  18.119203   4.622246 0.000000e+00
      1600   0.462907  17.696845   4.512695 0.000000e+00
      1632   0.539585  16.111294   4.106800 0.000000e+00
      1664   0.544271  16.930685   4.314069 0.000000e+00
      1696   0.546105  17.866159   4.550814 0.000000e+00
      1728   0.586472  17.595986   4.480459 0.000000e+00
      1760   0.605025  18.021669   4.587334 0.000000e+00
      1792   0.790022  14.568166   3.707078 0.000000e+00
      1824   0.685562  17.703431   4.503504 0.000000e+00
      1856   0.737331  17.342089   4.410273 0.000000e+00
      1888   0.754120  17.848244   4.537689 0.000000e+00
      1920   0.811271  17.448897   4.434928 0.000000e+00
      1952   0.862618  17.244515   4.381803 0.000000e+00
      1984   0.890333  17.542953   4.456476 0.000000e+00

BLOCK_SIZE=64
Dimension       Time    Gflop/s       GB/s        Error
        64   0.080875  24.731354   6.182839 0.000000e+00
       128   0.100138  19.979210   3.746102 0.000000e+00
       192   0.090982  22.093513   3.682252 0.000000e+00
       256   0.119062  16.909391   2.642092 0.000000e+00
       320   0.096115  21.137237   3.170586 0.000000e+00
       384   0.112566  18.108804   2.640867 0.000000e+00
       448   0.106493  20.263888   2.894841 0.000000e+00
       512   0.181884  11.806868   1.660341 0.000000e+00
       576   0.115841  19.796433   2.749505 0.000000e+00
       640   0.119185  17.595712   2.419410 0.000000e+00
       704   0.100871  20.753977   2.830088 0.000000e+00
       768   0.165658  16.406726   2.221744 0.000000e+00
       832   0.108458  21.240583   2.859309 0.000000e+00
       896   0.157135  18.310935   2.452357 0.000000e+00
       960   0.168577  20.992997   2.799066 0.000000e+00
      1024   0.197843  10.854458   1.441608 0.000000e+00
      1088   0.122861  20.965406   2.774833 0.000000e+00
      1152   0.174217  17.550846   2.315737 0.000000e+00
      1216   0.176359  20.390690   2.682986 0.000000e+00
      1280   0.256825  16.331364   2.143492 0.000000e+00
      1344   0.233321  20.810132   2.725136 0.000000e+00
      1408   0.310148  17.999883   2.352257 0.000000e+00
      1472   0.314180  20.303702   2.648309 0.000000e+00
      1536   0.594868  12.183814   1.586434 0.000000e+00
      1600   0.396322  20.670078   2.687110 0.000000e+00
      1664   0.508993  18.104144   2.350057 0.000000e+00
      1728   0.506272  20.383425   2.642296 0.000000e+00
      1792   0.696349  16.527876   2.139770 0.000000e+00
      1856   0.629201  20.322373   2.627893 0.000000e+00
      1920   0.791229  17.890882   2.310906 0.000000e+00
      1984   0.759584  20.562652   2.653245 0.000000e+00

BLOCK_SIZE=128
Dimension       Time    Gflop/s       GB/s        Error
       128   0.123946  16.141515   2.017689 0.000000e+00
       256   0.153528  13.113356   1.229377 0.000000e+00
       384   0.141930  14.362241   1.196853 0.000000e+00
       512   0.208615  10.294020   0.804220 0.000000e+00
       640   0.145811  14.382720   1.078704 0.000000e+00
       768   0.213840  12.710002   0.926771 0.000000e+00
       896   0.201815  14.257085   1.018363 0.000000e+00
      1024   0.215691   9.956287   0.700051 0.000000e+00
      1152   0.212363  14.398241   0.999878 0.000000e+00
      1280   0.325608  12.881471   0.885601 0.000000e+00
      1408   0.391822  14.247861   0.971445 0.000000e+00
      1536   0.731294   9.910871   0.671049 0.000000e+00
      1664   0.646497  14.253570   0.959375 0.000000e+00
      1792   0.916599  12.556382   0.840829 0.000000e+00
      1920   0.995432  14.220736   0.948049 0.000000e+00



BLOCK_SIZE=64 performs the best.

All timings are generated with -O3 -march=native flags. The cpuinfo of the machine used is:
Model name:          Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz
Stepping:            10
CPU MHz:             825.705
CPU max MHz:         4500.0000
CPU min MHz:         800.0000
BogoMIPS:            5199.98
Virtualization:      VT-x
L1d cache:           32K
L1i cache:           32K
L2 cache:            256K
L3 cache:            12288K
NUMA node0 CPU(s):   0-11

The peak flop-rate should be 4.5GHz * 4 = 18. Most of the time the recorded performance is smaller than that with a few exceptions on small matrices.
Given the L3 cache:12288KB, my L3 cache should be able to hold a matrix in whole with size=sqrt(12288e3B/8B)=1240.

The openmp part is not included as we discussed in slack.




